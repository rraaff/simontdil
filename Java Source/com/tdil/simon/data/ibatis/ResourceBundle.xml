<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE sqlMap      
    PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"      
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="ResourceBundle">

  <!-- Use type aliases to avoid typing the full classname every time. -->
  <typeAlias alias="ResourceBundle" type="com.tdil.simon.data.model.ResourceBundle"/>
  
 <select id="selectAllResourceBundle" resultClass="ResourceBundle">
    select
      *
    from RESOURCEBUNDLE
  </select>
  
  <select id="selectResourceBundleWithContextAndKey" parameterClass="java.util.Map" resultClass="ResourceBundle">
   select
      *
    from RESOURCEBUNDLE
    where rbContext = #rbContext#
    and rbKey = #rbKey#
  </select>
  
  <select id="selectAvailableContext" resultClass="String">
	SELECT rbContext FROM RESOURCEBUNDLE GROUP BY rbContext
  </select>

  <select id="selectAllForContext" parameterClass="java.lang.String" resultClass="ResourceBundle">
    select
      *
    from RESOURCEBUNDLE
    where rbContext = #rbContext#
  </select>
  
  <select id="selectResourceBundleByContextAndKey" parameterClass="java.util.Map" resultClass="ResourceBundle">
    select
      *
    from RESOURCEBUNDLE
    where rbContext = #rbContext#
    and rbKey = #rbKey#
  </select>
  
  <select id="searchResourceBundleByContextAndValue" parameterClass="java.util.Map" resultClass="ResourceBundle">
    select
      *
    from RESOURCEBUNDLE
    where 1 = 1
    <isNotNull prepend="AND" property="rbContext">
    	(rbContext = #rbContext#)
    </isNotNull>
    <isNotNull prepend="AND" property="rbValue">
    	(UPPER(rbValue) LIKE #rbValue#)
    </isNotNull>
  </select>
  
  <insert id="insertResourceBundle" parameterClass="ResourceBundle">
    INSERT INTO RESOURCEBUNDLE (
    	id, rbContext, rbKey, rbValue, deleted)
    values (
    	#id#, #rbContext#, #rbKey#, #rbValue#, #deleted#
    	)
    <selectKey resultClass="int" keyProperty="id">
     SELECT LAST_INSERT_ID() AS id
   </selectKey>
  </insert>
  
  <update id="updateResourceBundle" parameterClass="ResourceBundle">
    update RESOURCEBUNDLE set
      rbValue = #rbValue#
    where rbContext = #rbContext#
      and rbKey = #rbKey#
  </update>
  
</sqlMap>